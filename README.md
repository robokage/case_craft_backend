# CaseCraft Backend

CaseCraft is a backend service for generating custom phone skins and
wallpapers using generative AI.\
The project powers [CaseCraft.space](https://www.casecraft.space/) and
is built with **FastAPI**, **PostgreSQL**, **Redis**, and **Docker
Compose**.\
It integrates with **Replicate** for image generation and supports both
standard authentication and Google OAuth.


## âœ¨ Live Demo

ğŸ‘‰ <https://www.casecraft.space/>

## ğŸ“Œ Problem Statement

- Current platforms only provide **fixed templates** or **static designs** for phone skins.  
- Users lack **personalized, creative, and AI-driven customization options**.  
- CaseCraft solves this by offering **100% custom AI-generated designs**, aligned to real phone dimensions. 


## ğŸš€ Features

-   **User Authentication**
    -   Email-based signup/login with secure password hashing.
    -   Google OAuth2 login support.
    -   Forgot password & reset password flow.
-   **Image Generation**
    -   AI-powered phone skin and wallpaper generation using
        **Replicate**.
    -   Mask-based image customization for phone models.
    -   Previews and multiple generations for user choice.
-   **Phone Models**
    -   Current support: only a subset of phone models (masks created).
    -   Future plan: add masks and support for more devices.
    -   Data & images scraped from
        [Dimensions.com](https://www.dimensions.com/collection/phones-cell-phones).
-   **Storage & Database**
    -   PostgreSQL for structured user + image data.
    -   Redis for caching & async task management.
    -   Cloudinary for storing generated images.
-   **Deployment**
    -   Docker Compose setup for reproducible deployments.
    -   Deployed on **AWS EC2** with Nginx reverse proxy.
    -   CI/CD planned for automated deployments.

## ğŸ”„ Flow of Operations

1. User selects **phone brand** â†’ **phone model**.  
2. User enters a **prompt** and clicks **Submit**.  
3. Backend calls **Replicate API** with the selected phoneâ€™s **aspect ratio** to generate the image.  
4. Once generated:  
   - The backend **applies the phone mask** (phone outline overlay) â†’ preview image shown to user.  
   - In the background, the backend requests **upscaling** via Real-ESRGAN â†’ stores result in **S3**.  
5. If the user clicks **Download**:  
   - If upscaling is finished â†’ fetch from **S3** and return.  
   - If still processing â†’ Redis tracks state, user is asked to **wait**.  
6. Phone masks are stored in **S3** and fetched by backend at generation time.  


## ğŸ› ï¸ Tech Stack

-   **Backend Framework:** FastAPI
-   **Database:** PostgreSQL
-   **Cache/Queue:** Redis
-   **Image Generation:** Replicate API
-   **Authentication:** Custom auth + Google OAuth2
-   **Deployment:** Docker Compose on AWS EC2
-   **Storage:** AWS S3

## ğŸ“‚ Project Structure
 
    casecraft-backend/
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ db.py
    â”‚   â”œâ”€â”€ main.py
    â”‚   â”œâ”€â”€ models.py
    â”‚   â”œâ”€â”€ schemas.py
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ routers/
    â”‚       â”œâ”€â”€ generate.py
    â”‚       â”œâ”€â”€ phones.py
    â”‚       â”œâ”€â”€ users.py
    â”‚       â””â”€â”€ __init__.py
    â”‚
    â”œâ”€â”€ migrations/
    â”‚   â”œâ”€â”€ env.py
    â”‚   â”œâ”€â”€ README
    â”‚   â”œâ”€â”€ script.py.mako
    â”‚   â””â”€â”€ versions/          # Database migration files (auto-generated by Alembic)
    â”‚
    â”œâ”€â”€ scripts/
    â”‚   â”œâ”€â”€ auth.py
    â”‚   â”œâ”€â”€ dimensions_web_scrapper.py
    â”‚   â”œâ”€â”€ seed_phone_brands_models.py
    â”‚   â”œâ”€â”€ upload_masks_to_s3.py
    â”‚   â”œâ”€â”€ utils.py
    â”‚   â””â”€â”€ __init__.py
    â”‚
    â”œâ”€â”€ templates/
    â”‚   â””â”€â”€ reset_password_mail.html
    â”‚
    â”œâ”€â”€ screenshots/           # Used in README.md
    â”‚   â”œâ”€â”€ homepage.png
    â”‚   â”œâ”€â”€ login_page.png
    â”‚   â”œâ”€â”€ signup_page.png
    â”‚   â”œâ”€â”€ gen_example_1.png
    â”‚   â””â”€â”€ downloaded_example_1.png
    â”‚
    â”œâ”€â”€ alembic.ini
    â”œâ”€â”€ docker-compose.yaml
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ requirements.txt
    â””â”€â”€ README.md


## ğŸ“¦ Installation & Setup

1.  Clone the repo:

    ``` bash
    git clone https://github.com/robokage/case_craft_backend.git
    cd case_craft_backend
    ```

2.  Create a `.env` file:

    ``` env
    DATABASE_URL=postgresql://user:password@db:5432/casecraft
    REDIS_SERVER=localhost
    REDIS_PORT=6379
    REPLICATE_API_TOKEN=your_replicate_token
    AWS_ACCESS_KEY_ID=your_access_key_id
    AWS_SECRET_ACCESS_KEY=your_secret_access_key
    AWS_REGION=aws-region
    AWS_S3_BUCKET=your-bucket-name
    SECRET_KEY=your_secret_key
    JWT_ALGORITHM=your_jwt_algorithm
    ACCESS_TOKEN_EXPIRE_MINUTES=15
    GOOGLE_CLIENT_ID=your_google_client_id
    GOOGLE_CLIENT_SECRET=your_google_client_secret
    GOOGLE_REDIRECT_URI=https://localhost:8000/user/google/callback
    ```

3.  Start with Docker Compose:

    ``` bash
    docker-compose up --build
    ```

4.  Run database migrations:

    ``` bash
    alembic upgrade head
    ```

5.  Access API at: `http://localhost:8000`



## ğŸ” Authentication Flow

-   **Email Signup/Login**
-   **Forgot Password â†’ Reset Link**
-   **JWT-based sessions**
-   **Google OAuth2 login**



## ğŸ“ˆ Roadmap / To Do

- [ ] **CI/CD**: Add CI/CD pipeline for automated deployments
- [ ] **Phone Models**: Create mask and add support for more phone models
- [ ] **Theme Packs**: Anime, sports, artistic, etc. â†’ train small **LoRA models** (10â€“30 images per theme). 
- [ ] **User Library**: Signed-in users can view images generated in the last 48 hours.   
- [ ] **Digital Marketplace**: Community-driven platform for **sharing & monetizing designs**.  
- [ ] **Image Editing**: Allow editing of generated or user-uploaded images via prompts (Flux Kontext / Nano Banana).  
- [ ] **Prompt Enhancements**: Make prompts better understood for **phone-skin generation context**. 
- [ ] **Background Jobs**: Scheduled cleanup (e.g., Celery) â†’ delete images from S3 after 48 hours.  


## ğŸ“¸ Screenshots

### Homepage

![Homepage](screenshots/homepage.png)

### Image Generation

![Image Generation](screenshots/gen_example_1.png)

### Signup

![Signup](screenshots/signup_page.png)

### Login

![Login](screenshots/login_page.png)
